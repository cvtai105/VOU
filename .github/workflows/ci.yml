name: Run Tests

on:
  pull_request:
    paths-ignore: 
      - 'docker-compose.host.yml'
    branches: [ main, monolith ]


jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ‚öôÔ∏è
        uses: actions/checkout@v4
    
      - name: Make .env file üìÑ
        run: |
          cd src
          echo "API_VERSION=test" > .env
          echo "GOOGLE_CLIENT_ID=907759503353-5v3aon6s0fdhklod6qsc6bedrt3vketk.apps.googleusercontent.com" >> .env
          echo "GOOGLE_CLIENT_SECRET=${{ secrets.GOOGLE_CLIENT_SECRET }}" >> .env
          
          echo "CORS_ALLOWED_ORIGINS=*" >> .env

          echo "JWT_SECRET=sF9p8kzL6mBxV7rQw3Xj4PzH2vN8tK5c" >> .env
          echo "JWT_ISSUER=VOU-BE" >> .env
          echo "JWT_AUDIENCE=VOU-FE" >> .env

          echo "WEB_UI_VERSION=test" > .env
          echo "VITE_API_URL=http://localhost:8080" > .env
          echo "VITE_GOOGLE_CLIENT_ID=907759503353-5v3aon6s0fdhklod6qsc6bedrt3vketk.apps.googleusercontent.com" >> .env
          echo "VITE_GOOGLE_REDIRECT_URI=http://localhost:5173/oauth2/google/redirected" >> .env

      # Start apis and database
      - name: Start containers üê≥
        run: |
          docker compose -f docker-compose.dev.yml up --build -d
        
    #   # Setup and test locally
    #   - name: Install node ‚öôÔ∏è
    #     uses: actions/setup-node@v4
    #     with:
    #       node-version: lts/*
    #   - name: Install dependencies
    #     run: npm ci
    #   - name: Install Playwright Browsers
    #     run: npx playwright install --with-deps
    #   - name: Run Playwright tests
    #     run: npx playwright test
    #   - uses: actions/upload-artifact@v4
    #     if: ${{ !cancelled() }}
    #     with:
    #       name: playwright-report
    #       path: playwright-report/
    #       retention-days: 30

    #   #TODO: renew .env to product and perform smoke tests